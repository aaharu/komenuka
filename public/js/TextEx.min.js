/*!
* Text
* Visit http://createjs.com/ for documentation, updates and examples.
*
* Copyright (c) 2010 gskinner.com, inc.
*
* Permission is hereby granted, free of charge, to any person
* obtaining a copy of this software and associated documentation
* files (the "Software"), to deal in the Software without
* restriction, including without limitation the rights to use,
* copy, modify, merge, publish, distribute, sublicense, and/or sell
* copies of the Software, and to permit persons to whom the
* Software is furnished to do so, subject to the following
* conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
* OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
* HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
* WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
* OTHER DEALINGS IN THE SOFTWARE.
*/
!function(){if("undefined"==typeof createjs.Text)setTimeout(argments.callee,100);else{var a=createjs.Text.prototype;a.blockProgression="tb",a._drawText=function(a){var b=!!a;b||(a=this._getWorkingContext());var c=String(this.text).split(/(?:\r\n|\r|\n)/),d=this.lineHeight||this.getMeasuredLineHeight();"rl"===this.blockProgression&&(d=this.font.match(/(\d+)px /)[1]);for(var e=0,f=0,g=c.length;g>f;f++){var h=a.measureText(c[f]).width;if(null===this.lineWidth||h<this.lineWidth)b&&this._drawTextLine(a,c[f],e*d),e++;else{for(var i=c[f].split(/(\s)/),j=i[0],k=1,l=i.length;l>k;k+=2)a.measureText(j+i[k]+i[k+1]).width>this.lineWidth?(b&&this._drawTextLine(a,j,e*d),e++,j=i[k+1]):j+=i[k]+i[k+1];b&&this._drawTextLine(a,j,e*d),e++}}return e},a._drawTextLine=function(a,b,c){"rl"===this.blockProgression?this._drawVerticalTextLine(a,b,c):this.outline?a.strokeText(b,0,c,this.maxWidth||65535):a.fillText(b,0,c,this.maxWidth||65535)},a._drawVerticalTextLine=function(a,b,c){var d,e,f,g=b.length,h=this.lineHeight||this.getMeasuredLineHeight(),i=0,j=this.font.match(/(\d+)px /)[1];if(this.outline)for(d=0;g>d;++d){switch(e=this._getCharType(b.charAt(d))){case"long":case"punctuation":case"small":case"parentheses":f=h;break;case"rotate-ascii":f=a.measureText(b.charAt(d)).width;break;default:f=h}i+=f,this._updateMatrix(a,e,-c,i,j,f),a.strokeText(b.charAt(d),-c,i)}else for(d=0;g>d;++d){switch(e=this._getCharType(b.charAt(d))){case"long":case"punctuation":case"small":case"parentheses":f=h;break;case"rotate-ascii":f=a.measureText(b.charAt(d)).width;break;default:f=h}i+=f,this._updateMatrix(a,e,-c,i,j,f),a.fillText(b.charAt(d),-c,i)}},a._updateMatrix=function(a,b,c,d,e,f){var g=this.getMatrix();g.appendMatrix(this._getVerticalTextMatrix(b,c,d,e,f)),a.setTransform(g.a,g.b,g.c,g.d,g.tx,g.ty)},a._getCharType=function(a){return/^[\u30FC\u301C\uFF5E\u2026\uFF1D]$/.test(a)?"long":/^[\u3001\uFF0C\u3002\uFF0E]$/.test(a)?"punctuation":/^[\u3041\u3043\u3045\u3047\u3049\u3083\u3085\u3087\u3063\u30A1\u30A3\u30A5\u30A7\u30A9\u30E3\u30E5\u30E7\u30C3]$/.test(a)?"small":/^[\u3008\u3009\u300A\u300B\u3010\u3011\u3016\u3017\uFF08\uFF09\uFF5F\uFF60\u300C\u300D\u300E\u300F\u3014\u3015\u3018\u3019\uFF5B\uFF5D\uFF1C\uFF1E\u201C\u201D\u2018\u2019]$/.test(a)?"parentheses":'"'===a||"'"===a||"-"===a||"/"===a||":"===a||";"===a||"<"===a||"="===a||">"===a||"["===a||"]"===a||"\\"===a||"{"===a||"|"===a||"}"===a||"("===a||")"===a?"rotate-ascii":""},a._getVerticalTextMatrix=function(a,b,c,d,e){switch(a){case"long":return this._calculateMatrix(1,-1,270,-b+c+.4*d,b-c-.45*e);case"punctuation":return this._calculateMatrix(1,1,0,.625*d,-.625*e);case"small":return this._calculateMatrix(1,1,0,.15*d,-.15*e);case"parentheses":return this._calculateMatrix(1,1,90,-b+c+.4*d,-b-c-.4*e);case"rotate-ascii":return this._calculateMatrix(1,1,90,-b+c+.8*d,-b-c-1.65*e);default:return new createjs.Matrix2D(1,0,0,1,0,0)}},a._calculateMatrix=function(a,b,c,d,e){var f=c*Math.PI/180,g=Math.cos(f),h=Math.sin(f);return new createjs.Matrix2D(a*g,b*h,-a*h,b*g,a*(g*d-h*e),b*(h*d+g*e))}}}();