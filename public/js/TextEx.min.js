/*
* Text
* Visit http://createjs.com/ for documentation, updates and examples.
*
* Copyright (c) 2010 gskinner.com, inc.
* 
* Permission is hereby granted, free of charge, to any person
* obtaining a copy of this software and associated documentation
* files (the "Software"), to deal in the Software without
* restriction, including without limitation the rights to use,
* copy, modify, merge, publish, distribute, sublicense, and/or sell
* copies of the Software, and to permit persons to whom the
* Software is furnished to do so, subject to the following
* conditions:
* 
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
* 
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
* OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
* HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
* WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
* OTHER DEALINGS IN THE SOFTWARE.
*/
;this.createjs=this.createjs||{};(function(){var a=function(e,d,c){this.initialize(e,d,c)};var b=a.prototype=new createjs.DisplayObject();a._workingContext=(createjs.createCanvas?createjs.createCanvas():document.createElement("canvas")).getContext("2d");b.text="";b.font=null;b.color="#000";b.textAlign="left";b.textBaseline="top";b.maxWidth=null;b.outline=false;b.lineHeight=0;b.lineWidth=null;b.direction="horizontal";b.DisplayObject_initialize=b.initialize;b.initialize=function(e,d,c){this.DisplayObject_initialize();this.text=e;this.font=d;this.color=c?c:"#000"};b.isVisible=function(){var c=this.cacheCanvas||(this.text!=null&&this.text!=="");return !!(this.visible&&this.alpha>0&&this.scaleX!=0&&this.scaleY!=0&&c)};b.DisplayObject_draw=b.draw;b.draw=function(c,d){if(this.DisplayObject_draw(c,d)){return true}if(this.outline){c.strokeStyle=this.color}else{c.fillStyle=this.color}c.font=this.font;c.textAlign=this.textAlign||"start";c.textBaseline=this.textBaseline||"alphabetic";this._drawText(c);return true};b.getMeasuredWidth=function(){return this._getWorkingContext().measureText(this.text).width};b.getMeasuredLineHeight=function(){return this._getWorkingContext().measureText("M").width*1.2};b.getMeasuredHeight=function(){return this._drawText()*(this.lineHeight||this.getMeasuredLineHeight())};b.clone=function(){var c=new a(this.text,this.font,this.color);this.cloneProps(c);return c};b.toString=function(){return"[TextEx (text="+(this.text.length>20?this.text.substr(0,17)+"...":this.text)+")]"};b.DisplayObject_cloneProps=b.cloneProps;b.cloneProps=function(c){this.DisplayObject_cloneProps(c);c.textAlign=this.textAlign;c.textBaseline=this.textBaseline;c.maxWidth=this.maxWidth;c.outline=this.outline;c.lineHeight=this.lineHeight;c.lineWidth=this.lineWidth};b._getWorkingContext=function(){var c=a._workingContext;c.font=this.font;c.textAlign=this.textAlign||"start";c.textBaseline=this.textBaseline||"alphabetic";return c};b._drawText=function(p){var g=!!p;if(!g){p=this._getWorkingContext()}var q=String(this.text).split(/(?:\r\n|\r|\n)/);var n=this.lineHeight||this.getMeasuredLineHeight();var h=0;for(var f=0,c=q.length;f<c;f++){var o=p.measureText(q[f]).width;if(this.lineWidth==null||o<this.lineWidth){if(g){this._drawTextLine(p,q[f],h*n)}h++;continue}var m=q[f].split(/(\s)/);var k=m[0];for(var d=1,e=m.length;d<e;d+=2){if(p.measureText(k+m[d]+m[d+1]).width>this.lineWidth){if(g){this._drawTextLine(p,k,h*n)}h++;k=m[d+1]}else{k+=m[d]+m[d+1]}}if(g){this._drawTextLine(p,k,h*n)}h++}return h};b._drawTextLine=function(d,g,h){if(this.direction==="vertical"){var f=this.lineHeight||this.getMeasuredLineHeight();if(this.outline){for(var e=0,c=g.length;e<c;++e){d.strokeText(g.charAt(e),-h,e*f,this.maxWidth||65535)}}else{for(var e=0,c=g.length;e<c;++e){d.fillText(g.charAt(e),-h,e*f,this.maxWidth||65535)}}}else{if(this.outline){d.strokeText(g,0,h,this.maxWidth||65535)}else{d.fillText(g,0,h,this.maxWidth||65535)}}};createjs.TextEx=a}());
