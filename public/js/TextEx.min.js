/*
* Text
* Visit http://createjs.com/ for documentation, updates and examples.
*
* Copyright (c) 2010 gskinner.com, inc.
* 
* Permission is hereby granted, free of charge, to any person
* obtaining a copy of this software and associated documentation
* files (the "Software"), to deal in the Software without
* restriction, including without limitation the rights to use,
* copy, modify, merge, publish, distribute, sublicense, and/or sell
* copies of the Software, and to permit persons to whom the
* Software is furnished to do so, subject to the following
* conditions:
* 
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
* 
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
* OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
* HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
* WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
* OTHER DEALINGS IN THE SOFTWARE.
*/
;this.createjs=this.createjs||{};(function(){var a=function(e,d,c){this.initialize(e,d,c)};var b=a.prototype=new createjs.Text();b.blockProgression="tb";b.toString=function(){return"[TextEx (text="+(this.text.length>20?this.text.substr(0,17)+"...":this.text)+", blockProgression="+this.blockProgression+")]"};b._drawTextLine=function(c,d,e){if(this.blockProgression==="rl"){this._drawVerticalTextLine(c,d,e)}else{if(this.outline){c.strokeText(d,0,e,this.maxWidth||65535)}else{c.fillText(d,0,e,this.maxWidth||65535)}}};b._drawVerticalTextLine=function(d,g,h){var e,c=g.length,f=this.lineHeight||this.getMeasuredLineHeight();if(this.outline){for(e=0;e<c;++e){this._updateMatrix(d,this._getCharType(g.charAt(e)),-h,e*f,d.measureText(g.charAt(e)).width,f);d.strokeText(g.charAt(e),-h,e*f,this.maxWidth||65535)}}else{for(e=0;e<c;++e){this._updateMatrix(d,this._getCharType(g.charAt(e)),-h,e*f,d.measureText(g.charAt(e)).width,f);d.fillText(g.charAt(e),-h,e*f,this.maxWidth||65535)}}};b._updateMatrix=function(e,i,c,j,d,g){var f=this.getMatrix();f.appendMatrix(this._getVerticalTextMatrix(i,c,j,d,g));e.setTransform(f.a,f.b,f.c,f.d,f.tx,f.ty)};b._getCharType=function(d){if(d==="\u30FC"||d==="\u301C"||d==="\uFF5E"||d==="\u2026"||d==="\uFF1D"){return"long"}else{if(d==="\u3001"||d==="\uFF0C"||d==="\u3002"||d==="\uFF0E"){return"punctuation"}else{if(/^[\u3041\u3043\u3045\u3047\u3049\u3083\u3085\u3087\u3063\u30A1\u30A3\u30A5\u30A7\u30A9\u30E3\u30E5\u30E7\u30C3]$/.test(d)){return"small"}else{if(/^[\u3009\u300B\u300D\u300F\u3011\u3015\u3017\u3019\uFF09\uFF5D\uFF60\u3008\u300A\u300C\u300E\u3010\u3014\u3016\u3018\uFF08\uFF5B\uFF5F\uFF1C\uFF1E]$/.test(d)){return"parentheses"}}}}return""};b._getVerticalTextMatrix=function(f,c,g,d,e){switch(f){case"long":return this._calculateMatrix(1,-1,270,-c+g+d/2,c-g-e/2);break;case"punctuation":return this._calculateMatrix(1,1,0,0.625*d,-0.625*e);break;case"small":return this._calculateMatrix(1,1,0,0.125*d,-0.125*e);break;case"parentheses":return this._calculateMatrix(1,1,90,-c+g+e/2,-c-g-d/2);break;default:return new createjs.Matrix2D(1,0,0,1,0,0);break}};b._calculateMatrix=function(j,i,g,f,d){var c=g*Math.PI/180;var h=Math.cos(c);var e=Math.sin(c);return new createjs.Matrix2D(j*h,i*e,-j*e,i*h,j*(h*f-e*d),i*(e*f+h*d))};createjs.TextEx=a}());
