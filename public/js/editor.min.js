var app,komenukaEditor;komenukaEditor={container:$("#main"),initEditor:function(){var a,b,c,d,e,f,g,h,i,j,k,l;return komenukaEditor.container.html(T.editor_edit.render()),d=$("#outjson"),e=$("#rectangleBtn"),a=$("#annotateBtn"),f=$("#tategakiBtn"),h=$("#undoBtn"),b=$("#drawText"),g=$("#textSize"),c=$("#komenukaUrlText"),j=new komenuka.Canvas(new createjs.Stage("canvas"),$("#colorPicker-r"),$("#colorPicker-w")),d.change(function(){var a,b;return b=location.hash.substring(1),/^http:\/\//i.test(b)&&(b=b.substring(7),a=b.match(/^(img\.)?tiqav\.com\/([\w\d]+(\.jpe?g|\.gif|\.png)?)$/i)),null!=a?c.val("http://"+location.host+"/tiqav/v1/"+encodeURIComponent(JSON.stringify(d.val()))+"/"+encodeURIComponent(a[2])):c.val("http://"+location.host+"/page/v1/"+encodeURIComponent(JSON.stringify(d.val()))+"/"+encodeURIComponent(b))}),$("#chkBtn").click(function(){return document.getElementById("komenukaImg").src=c.val(),!1}),l=location.hash.substring(1),e.attr({disabled:"disabled"}),a.attr({disabled:"disabled"}),f.attr({disabled:"disabled"}),h.attr({disabled:"disabled"}),b.attr({disabled:"disabled"}),g.attr({disabled:"disabled"}),l?(i=new Image,i.crossOrigin="Anonymous",i.onload=function(){return j.init(new createjs.Bitmap(i)),d.val(""),e.removeAttr("disabled"),a.removeAttr("disabled"),f.removeAttr("disabled"),h.removeAttr("disabled")},k=l.match(/^http:\/\/tiqav\.com\/([\w\d]+)$/i),null!==k?$.get("//allow-any-origin.appspot.com/http://api.tiqav.com/images/"+k[1]+".json",function(a){var b;return b="http://img.tiqav.com/"+a.id+"."+a.ext,$imageUrlText.val(b),i.src="//allow-any-origin.appspot.com/"+b}):i.src="//allow-any-origin.appspot.com/"+l,e.click(function(){return b.attr({disabled:"disabled"}),g.attr({disabled:"disabled"}),j.publishRectangleEvents()}),a.click(function(){return b.removeAttr("disabled"),g.removeAttr("disabled"),j.publishAnnotateEvents(b,g)}),f.click(function(){return b.removeAttr("disabled"),g.removeAttr("disabled"),j.publishTategakiEvents(b,g)}),h.click(function(){return j.undo()}),$("#spuitBtn").click(function(){return j.publishSpuitEvents()}),$("#canvas").on("komenuka:update",function(a,b){var e;return void 0===b||0===Object.keys(b).length?(d.val(""),c.val(""),void 0):(d.val(JSON.stringify(b)),/^http:\/\//i.test(l)&&(e=l.substring(7),k=e.match(/^(img\.)?tiqav\.com\/([\w\d]+(\.jpe?g|\.gif|\.png)?)$/i)),null!=k?c.val("http://"+location.host+"/tiqav/v1/"+encodeURIComponent(JSON.stringify(b))+"/"+encodeURIComponent(k[2])):c.val("http://"+location.host+"/page/v1/"+encodeURIComponent(JSON.stringify(b))+"/"+encodeURIComponent(e)))})):void 0}},null!=location.hash||""===location.hash?komenukaEditor.initEditor():komenukaEditor.container.html(T.editor_edit.render()),app=angular.module("app",[]),app.controller("EditorController",["$scope",function(a){return a.inputUrl=function(){return location.hash=a.url,komenukaEditor.initEditor()}}]);