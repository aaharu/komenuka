var app,komenukaEditor;komenukaEditor={container:$("#main"),initEditor:function(){var a,b,c,d,e,f,g,h,i,j,k,l;return komenukaEditor.container.html(T.editor_edit.render()),d=$("#outjson"),e=$("#rectangleBtn"),a=$("#annotateBtn"),f=$("#tategakiBtn"),h=$("#undoBtn"),b=$("#drawText"),g=$("#textSize"),c=$("#komenukaUrlText"),j=new komenuka.Canvas(new createjs.Stage("canvas"),$("#colorPicker-r"),$("#colorPicker-w")),d.change(function(){var a;return a=location.hash.substring(1),c.val("http://"+location.host+"/page/v1/"+encodeURIComponent(JSON.stringify(d.val()))+"/"+encodeURIComponent(a))}),$("#chkBtn").click(function(){return document.getElementById("komenukaImg").src=c.val().replace("page","image"),!1}),l=location.hash.substring(1),e.attr({disabled:"disabled"}),a.attr({disabled:"disabled"}),f.attr({disabled:"disabled"}),h.attr({disabled:"disabled"}),b.attr({disabled:"disabled"}),g.attr({disabled:"disabled"}),l?(i=new Image,i.crossOrigin="Anonymous",i.onload=function(){return j.init(new createjs.Bitmap(i)),d.val(""),e.removeAttr("disabled"),a.removeAttr("disabled"),f.removeAttr("disabled"),h.removeAttr("disabled")},k=l.match(/^http:\/\/tiqav\.com\/([\w\d]+)$/i),null!==k?$.get("//allow-any-origin.appspot.com/http://api.tiqav.com/images/"+k[1]+".json",function(a){var b;return b="http://img.tiqav.com/"+a.id+"."+a.ext,location.hash=b,l=b,i.src="//allow-any-origin.appspot.com/"+b}):i.src="//allow-any-origin.appspot.com/"+l,e.click(function(){return b.attr({disabled:"disabled"}),g.attr({disabled:"disabled"}),j.publishRectangleEvents()}),a.click(function(){return b.removeAttr("disabled"),g.removeAttr("disabled"),j.publishAnnotateEvents(b,g)}),f.click(function(){return b.removeAttr("disabled"),g.removeAttr("disabled"),j.publishTategakiEvents(b,g)}),h.click(function(){return j.undo()}),$("#spuitBtn").click(function(){return j.publishSpuitEvents()}),$("#canvas").on("komenuka:update",function(a,b){return void 0===b||0===Object.keys(b).length?(d.val(""),c.val(""),void 0):(d.val(JSON.stringify(b)),c.val("http://"+location.host+"/page/v1/"+encodeURIComponent(JSON.stringify(b))+"/"+encodeURIComponent(l)))})):void 0}},""===location.hash?komenukaEditor.container.html(T.editor_search.render()):komenukaEditor.initEditor(),app=angular.module("app",[]),app.controller("EditorController",["$scope",function(a){return a.inputUrl=function(){return location.hash=a.url,komenukaEditor.initEditor()}}]);